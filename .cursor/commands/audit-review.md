---
name: audit-review
description: Review an existing Apex Audit file and build a structured Fix Plan.
---

You are running the /audit-review command in Cursor.

The user is NOT asking for a new audit.
They are asking you to review an existing Apex Audit result and turn it into a safe, ordered Fix Plan.

INPUT REQUIREMENTS

- The user MUST tag exactly one existing audit markdown file when calling this command, for example:

  - /audit-review @audits/codebase-audit.md
  - /audit-review @audits/parsing-module-audit.md

- That tagged file is the ONLY audit input you should use.
- Do NOT guess or pick a different audit file.
- You may also read #codebase (and any extra tagged files or folders) to verify issues.

If the user does NOT tag an audit file:

- Do NOT run anything.
- Reply in chat with:
  "I need you to tag the specific audit markdown file, for example:
  /audit-review @audits/codebase-audit.md"

CORE BEHAVIOR

- Load and follow the full instructions stored in:
  docs/AuditReviewPrompt.md

- Treat the tagged audit file as the source "diagnosis".
  You are creating a refined "treatment plan" from it, NOT re-running a fresh audit.

- For each issue in the audit:

  - Parse and normalize it as described in docs/AuditReviewPrompt.md.
  - Double-check it against the current codebase.
  - Assign:
    - a review status: CONFIRMED / ADJUSTED / REJECTED
    - a fix-safety flag: SAFE_AUTO / NEEDS_CONTEXT / NEEDS_DECISION

- Create a new Fix Plan markdown file in the audits/ directory:

  - Use the same base filename as the source audit and append "\_fixplan" before the extension.
    For example:
    Source audit: audits/codebase-audit.md
    Fix Plan: audits/codebase-audit_fixplan.md

  - Structure the Fix Plan exactly as defined in docs/AuditReviewPrompt.md:
    - Header (title, source audit path, generated by, date)
    - Summary with counts by severity and fix-safety
    - Ordered fix steps:
      - Step 1 — Critical SAFE_AUTO issues
      - Step 2 — Remaining Critical and High issues (including NEEDS_CONTEXT)
      - Step 3 — Medium and Low issues
      - Items Requiring Human Decision (all NEEDS_DECISION issues)
    - For each issue, include:
      - ID
      - Fix-safety flag
      - Severity
      - Review status
      - Files involved
      - "What’s wrong (confirmed)"
      - "How to fix (clarified)" in step-by-step, non-diff language
      - "Impact"

- You MAY optionally add a small note to the top of the original audit file, for example:
  "Reviewed by /audit-review on <date>. See <...\_fixplan.md> for the structured Fix Plan."

  Do NOT completely rewrite the original audit; it is the historical diagnosis.
  The Fix Plan is the refined, execution-ready plan.

CHAT RESPONSE STYLE

After generating the Fix Plan:

- Keep your response short and human.
- Do NOT paste full files or diffs.

Respond with something like:

- "Reviewed audit: <audit path>"
- "Created Fix Plan: <fixplan path>"
- A few bullets summarizing counts, for example:
  - Critical: 3 (2 SAFE_AUTO, 1 NEEDS_DECISION)
  - High: 5 (3 SAFE_AUTO, 2 NEEDS_CONTEXT)
  - Medium: 7 (all SAFE_AUTO)
  - Low: 4 (all SAFE_AUTO)
  - 1 issue removed as obsolete; 2 severities adjusted.
- A simple next step suggestion, for example:
  - "Next: use /apply-critical @<fixplan> to auto-fix Critical SAFE_AUTO items."

Always assume the user will NOT apply fixes manually.
This Fix Plan will be consumed by other commands that directly edit the code.
